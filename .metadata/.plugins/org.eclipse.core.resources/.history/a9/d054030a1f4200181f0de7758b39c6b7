package FireEmblemGraphic;

import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;

import resources.Sip;

public class BatallaController implements MouseListener {
	
	private static final Sip player = new Sip();
	private BatallaView ventana;
	private Personaje tu;
	private Personaje enemy;
	
	public BatallaController(Personaje tu, Personaje enemy) {
		this.tu = tu;
		this.enemy = enemy;
		this.ventana = new BatallaView();
		setActions();
	}
	
	private void setActions() {
		this.ventana.getAceptar().addMouseListener(this);
		this.ventana.getCancelar().addMouseListener(this);
	}

	@Override
	public void mouseClicked(MouseEvent e) {
		if(e.getSource() == this.ventana.getAceptar()) {
			this.ventana.setCombate(true);
			player.play("horn.wav");
			this.ventana.dispose();
		} else if(e.getSource() == this.ventana.getCancelar()) {
			this.ventana.setCombate(false);
			this.ventana.dispose();
		}
		if (BatallaView.isCombate()) {
			if (tu.arma.getVentaja().equals(enemy.getArma())) {
				System.out.println("paso1");
				enemy.setHp(enemy.getHp() - ((int) Math.abs((tu.atk + (tu.atk * tu.arma.getPorcentaje())) - enemy.getDef())));
				if (enemy.getHp() != 0) {
					tu.setHp(tu.hp - ((int) Math.abs((enemy.getAtk() - (enemy.getAtk() * enemy.getArma().getPorcentaje())) - tu.def)));
					if (tu.hp == 0) {
						System.out.println("entrada1");
						tu.getCasilla().setPersonaje(null);
						tu.setCasilla(null);
					}
				} else {
					System.out.println("entrada2");
					enemy.getCasilla().setPersonaje(null);
					enemy.setCasilla(null);
				}
			} else if (tu.arma.getDesventaja().equals(enemy.getArma())) {
				enemy.setHp(enemy.getHp() - ((int) Math.abs((tu.atk - (tu.atk * tu.arma.getPorcentaje())) - enemy.getDef())));
				if (enemy.getHp() != 0) {
					tu.setHp(tu.hp - ((int) Math.abs((enemy.getAtk() + (enemy.getAtk() * enemy.getArma().getPorcentaje())) - tu.def)));
					if (tu.hp == 0) {
						tu.getCasilla().setPersonaje(null);
						tu.setCasilla(null);
					}
				} else {
					enemy.getCasilla().setPersonaje(null);
					enemy.setCasilla(null);
				}
			} else {
				enemy.setHp(enemy.getHp() - ((int) Math.abs(tu.atk - enemy.getDef())));
				if (enemy.getHp() != 0) {
					tu.setHp(tu.hp - ((int) Math.abs(enemy.getAtk() - tu.def)));
					if (tu.hp == 0) {
						tu.getCasilla().setPersonaje(null);
						tu.setCasilla(null);
					}
				} else {
					enemy.getCasilla().setPersonaje(null);
					enemy.setCasilla(null);
				}
			}
		}
		
	}

	@Override
	public void mousePressed(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void mouseReleased(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void mouseEntered(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void mouseExited(MouseEvent e) {
		// TODO Auto-generated method stub
		
	}

	public BatallaView getVentana() {
		return ventana;
	}

	public void setVentana(BatallaView ventana) {
		this.ventana = ventana;
	}
}
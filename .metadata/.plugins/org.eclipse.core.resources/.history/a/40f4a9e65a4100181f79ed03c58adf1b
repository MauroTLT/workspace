package Controller;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.BufferedWriter;
import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileWriter;
import java.io.IOException;

import javax.swing.JButton;

import Modelo.ModeloIMC;
import Vista.VistaIMC;

public class ControlerIMC implements ActionListener{
	private ModeloIMC modelo;
	private VistaIMC vista;
	private final float PESO_BAJO=18.5F,PESO_NORMAL=24.9F, SOBREPESO=29.9F, OBESIDAD1=34.9F,OBESIDAD2=39.9F;
	
	public ControlerIMC(){
		modelo = new ModeloIMC();
		vista = new VistaIMC(modelo.getTextoAltura(), modelo.getTextoMasa());
		initControler();
	}
	private void initControler(){
		vista.getBotonCalcular().addActionListener(this);
		vista.getBotonLimpiar().addActionListener(this);
	}
	@SuppressWarnings("static-access")
	@Override
	public void actionPerformed(ActionEvent e) {
		FileInputStream ficheroEntrada = null;
		BufferedWriter ficheroSalida = null;
		JButton source = (JButton)e.getSource();
		try{
			if(!new File("historial.txt").exists()) {
				ficheroEntrada = new FileInputStream(new File("historial.txt"));
			}
			ficheroSalida = new BufferedWriter(new FileWriter("historial.txt"));
			if(source.getText().equals("Calcular")){
				Double res= Double.parseDouble(vista.getTextMasa().getText())/Math.pow(Double.parseDouble(vista.getTextAltura().getText()), 2);
				vista.getLabelResNumero().setText(String.valueOf(res));
				/*vista.getLabelTextRes().setText((res < PESO_BAJO) ? "Peso bajo" : (res>PESO_NORMAL || res<SOBREPESO) ? "Sobrepeso" : (res>OBESIDAD1 || res< OBESIDAD2) ? "Obesidad 2" : "Obesidad 3");*/

				if(res<PESO_BAJO){
					vista.getLabelTextRes().setText("Peso bajo");
				}else if(res>PESO_BAJO || res<PESO_NORMAL){
					vista.getLabelTextRes().setText("Peso Normal");
				}else if(res>PESO_NORMAL || res<SOBREPESO){
					vista.getLabelTextRes().setText("Sobrepeso");
				}else if(res>SOBREPESO || res<OBESIDAD1){
					vista.getLabelTextRes().setText("Obesidad 1");
				}else if (res>OBESIDAD1 || res< OBESIDAD2){
					vista.getLabelTextRes().setText("Obesidad 2");
				}else{
					vista.getLabelTextRes().setText("Obesidad 3");
				}
				
			} else if(source.getText().equals("Limpiar")) {
				vista.getLabelResNumero().setText("");
				vista.getTextAltura().setText("");
				vista.getLabelTextRes().setText("");
				vista.getTextMasa().setText("");
			} else {
				
			}
		}catch(NumberFormatException | IOException e1){
			vista.getMensaje().showMessageDialog(null, "Datos no validos");
		}
	}
}

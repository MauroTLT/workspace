package View;

import java.awt.Color;
import java.awt.Font;
import java.awt.Image;
import java.util.Random;

import javax.swing.BorderFactory;
import javax.swing.ImageIcon;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.SwingConstants;

import Model.Aldeano;
import Model.Biblioteca;
import Model.Calle;
import Model.Casilla;
import Model.Descampado;
import Model.Gimnasio;
import Model.Hospital;
import Model.Protagonista;

@SuppressWarnings("serial")
public class BatallaView extends JFrame {

	public static void main(String[] args) {
		Casilla c = new Casilla();
		c.getPersonajes()[1] = new Protagonista();
		c.getPersonajes()[0] = new Aldeano();
		c.setEdificio(new Calle());
		BatallaView batalla = new BatallaView(c);
		for (int i = 0; i < 4; i++) {
			batalla.lanzar();
		}
	}
	private final static Random r = new Random();
	private JLabel protaImg, enemyImg, dado1, dado2, dado3, ronda, damage;
	private int turno = 0;
	
	public BatallaView(Casilla casilla) {
		this.protaImg = new JLabel();
		this.enemyImg = new JLabel();
		this.dado1 = new JLabel();
		this.dado2 = new JLabel();
		this.dado3 = new JLabel();
		this.ronda = new JLabel("Turno del Protagonista", SwingConstants.CENTER);
		this.damage = new JLabel("100");
		darFormato(casilla);
	}

	private void darFormato(Casilla casilla) {
		this.setLayout(null);
		if(casilla.getEdificio() instanceof Gimnasio) {
			JLabel background = new JLabel();
			Image bg = new ImageIcon(getClass().getResource("../resources/extras/gymBG.png")).getImage();
			background.setIcon(new ImageIcon(bg.getScaledInstance(800, 600, Image.SCALE_SMOOTH)));
			this.setContentPane(background);
		} else if(casilla.getEdificio() instanceof Descampado) {
			JLabel background = new JLabel();
			Image bg = new ImageIcon(getClass().getResource("../resources/extras/descampadoBG.png")).getImage();
			background.setIcon(new ImageIcon(bg.getScaledInstance(800, 600, Image.SCALE_SMOOTH)));
			this.setContentPane(background);
		} else if(casilla.getEdificio() instanceof Calle) {
			JLabel background = new JLabel();
			Image bg = new ImageIcon(getClass().getResource("../resources/extras/calleBG.png")).getImage();
			background.setIcon(new ImageIcon(bg.getScaledInstance(800, 600, Image.SCALE_SMOOTH)));
			this.setContentPane(background);
		} else if(casilla.getEdificio() instanceof Hospital) {
			JLabel background = new JLabel();
			Image bg = new ImageIcon(getClass().getResource("../resources/extras/hospitalBG.png")).getImage();
			background.setIcon(new ImageIcon(bg.getScaledInstance(800, 600, Image.SCALE_SMOOTH)));
			this.setContentPane(background);
		} else if(casilla.getEdificio() instanceof Biblioteca) {
			JLabel background = new JLabel();
			Image bg = new ImageIcon(getClass().getResource("../resources/extras/biblioBG.png")).getImage();
			background.setIcon(new ImageIcon(bg.getScaledInstance(800, 600, Image.SCALE_SMOOTH)));
			this.setContentPane(background);
		}
		this.protaImg.setBounds(250,350,200,200);
		this.protaImg.setIcon(new ImageIcon(getClass().getResource("../resources/sprites/maximBack.png")));
		this.add(protaImg);
		
		this.enemyImg.setBounds(350,200,200,200);
		Image per = new ImageIcon(getClass().getResource("../resources/sprites/aldeano.png")).getImage();
		this.enemyImg.setIcon(new ImageIcon(per.getScaledInstance(150, 150, Image.SCALE_SMOOTH)));
		this.add(enemyImg);
		
		dados();
		
		this.damage.setBounds(300,350,100,50);
		this.damage.setFont(new Font("TimesRoman", Font.BOLD, 36));
		this.damage.setForeground(Color.red);
		this.add(damage);
		this.damage.setVisible(false);
		
		this.ronda.setBounds(50,100,700,75);
		this.ronda.setFont(new Font("TimesRoman", Font.BOLD, 50));
		this.ronda.setBackground(Color.black);
		this.ronda.setOpaque(true);
		this.ronda.setForeground(Color.lightGray);
		this.ronda.setBorder(BorderFactory.createLineBorder(Color.gray, 5, true));
		this.add(ronda);
		this.ronda.setVisible(false);
		
		this.setSize(800, 600);
		this.setUndecorated(true);
		this.setLocationRelativeTo(null);
		this.setDefaultCloseOperation(DISPOSE_ON_CLOSE);
		this.setVisible(true);
	}

	private void dados() {
		if (this.dado1.isVisible()) {
			this.dado1.setBounds(210, 40, 100, 100);
			//this.dado1.setOpaque(true);
			//this.dado1.setBackground(new Color(0, 0, 0, 175));
			this.dado1.setIcon(new ImageIcon(getClass().getResource("../resources/extras/" + (r.nextInt(6) + 1) + ".png")));
			this.add(dado1);
			this.dado1.setVisible(false);
			this.dado2.setBounds(345, 40, 100, 100);
			//this.dado2.setOpaque(true);
			//this.dado2.setBackground(new Color(0, 0, 0, 175));
			this.dado2.setIcon(new ImageIcon(getClass().getResource("../resources/extras/" + (r.nextInt(6) + 1) + ".png")));
			this.add(dado2);
			this.dado2.setVisible(false);
			this.dado3.setBounds(480, 40, 100, 100);
			//this.dado3.setOpaque(true);
			//this.dado3.setBackground(new Color(0, 0, 0, 175));
			this.dado3.setIcon(new ImageIcon(getClass().getResource("../resources/extras/" + (r.nextInt(6) + 1) + ".png")));
			this.add(dado3);
			this.dado3.setVisible(false);
		}
	}
	private void lanzar() {
		try {
			if (turno % 2 == 0) {
				this.ronda.setText("Turno del Protagonista");
			} else {
				this.ronda.setText("Turno del Enemigo");
			}
			this.ronda.setHorizontalAlignment(SwingConstants.CENTER);
			this.ronda.setVisible(true);
			Thread.sleep(1000);
			this.dado1.setVisible(true);
			Thread.sleep(1000);
			this.dado2.setVisible(true);
			Thread.sleep(1000);
			this.dado3.setVisible(true);
			Thread.sleep(3000);
			dados();
			if (turno % 2 == 0) {
				Image per = new ImageIcon(getClass().getResource("../resources/sprites/aldeano.png")).getImage();
				this.enemyImg.setIcon(new ImageIcon(per.getScaledInstance(150, 150, Image.SCALE_SMOOTH)));
				this.protaImg.setIcon(new ImageIcon(getClass().getResource("../resources/sprites/maxim1.gif")));
				this.damage.setText("100");
				Thread.sleep(1000);
				this.protaImg.setIcon(new ImageIcon(getClass().getResource("../resources/sprites/maximBack.png")));
			} else {
				this.protaImg.setIcon(new ImageIcon(getClass().getResource("../resources/sprites/maximBack.png")));
				this.enemyImg.setIcon(new ImageIcon(getClass().getResource("../resources/sprites/aldeano.gif")));
				this.damage.setText("50");
				Thread.sleep(1000);
			}
			Thread.sleep(2000);
			this.ronda.setVisible(false);
			damage();
			this.turno++;
		} catch (InterruptedException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	private void damage() {
		this.damage.setVisible(true);
		while(this.damage.getLocation().getY() >= 250) {
			this.damage.setLocation(300, (int)this.damage.getLocation().getY()-5);
			try {
				Thread.sleep(100);
			} catch (InterruptedException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		this.damage.setVisible(false);
		this.damage.setLocation(300, 350);
		
	}

}
